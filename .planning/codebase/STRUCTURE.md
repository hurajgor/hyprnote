# Codebase Structure

**Analysis Date:** 2026-02-11

## Directory Layout

```
hyprnote/
├── apps/                    # Standalone application entry points
│   ├── api/                # Axum backend API gateway server
│   ├── web/                # TanStack Start React public web app
│   ├── desktop/            # Tauri native desktop application
│   ├── bot/                # Slack bot and automation services
│   ├── pro/                # Pro/premium features (legacy)
│   ├── meetingsucks/       # Meeting transcription service
│   ├── restate/            # Restate workflow orchestration
│   ├── stripe/             # Stripe webhook processor
│   ├── eval-cli/           # Evaluation and testing CLI
│   ├── granola/            # Data processing service
│   ├── k6/                 # Performance testing scripts
│   ├── storybook/          # Component documentation
│   ├── slack-internal/     # Internal Slack integrations
│   └── tools/              # Utility CLI tools
├── crates/                 # Shared library crates (100+)
│   ├── api-auth/          # Authentication core
│   ├── api-calendar/      # Calendar integration service
│   ├── api-nango/         # Nango integration adapter
│   ├── api-subscription/  # Subscription/billing logic
│   ├── api-support/       # Support ticket system
│   ├── audio-*/           # Audio processing utilities
│   ├── transcribe-*/      # STT provider clients
│   ├── llm/               # LLM interface
│   ├── llm-proxy/         # LLM provider proxy
│   ├── db-*/              # Database layers
│   ├── notification/      # Notification system
│   └── [60+ more]         # Specialized domain crates
├── plugins/                # Tauri desktop plugins (50+)
│   ├── auth/              # Authentication plugin
│   ├── db2/               # Database access plugin
│   ├── listener/          # Audio listener
│   ├── local-llm/         # Local LLM execution
│   ├── hooks/             # System hooks
│   ├── extensions/        # Browser extension support
│   └── [45+ more]         # Feature plugins
├── .planning/              # GSD planning documents
│   └── codebase/          # Architecture documentation
├── Cargo.toml             # Rust workspace root
├── AGENTS.md              # Claude project instructions
└── [config files]         # Rust/Node/formatting configs
```

## Directory Purposes

**`apps/`:**
- Purpose: Standalone binary/application entry points
- Contains: Main functions, app-specific routing, configuration
- Key files: Each app has `Cargo.toml` (Rust) or `package.json` (Node), `src/main.rs` or `src/`, AGENTS.md
- Apps share code via workspace dependency references (`hypr-*` crates)

**`crates/`:**
- Purpose: Reusable library code shared across apps
- Contains: Domain logic, data models, service abstractions, integrations
- Pattern: 100+ crates organized by domain (api-*, audio-*, transcribe-*, db-*, etc.)
- Each crate has `src/lib.rs` as entry point (not `main.rs`)
- Shared via workspace root `Cargo.toml` with `hypr-*` published name

**`plugins/`:**
- Purpose: Tauri desktop app extensions providing new functionality
- Contains: Rust backend (`src-tauri/src/`) + TypeScript frontend (`dist/`)
- Pattern: Each plugin is self-contained with its own `Cargo.toml`, `package.json`
- Initialization: Plugins registered in `apps/desktop/src-tauri/src/lib.rs` via `.plugin()`
- Examples:
  - `plugins/auth/` - Authentication/credentials
  - `plugins/db2/` - Local database operations
  - `plugins/local-llm/` - Run LLM models locally
  - `plugins/listener/` - Audio capture and processing
  - `plugins/hooks/` - System event hooks
  - `plugins/mcp/` - Model Context Protocol support

**`.planning/codebase/`:**
- Purpose: GSD architecture documentation
- Contains: ARCHITECTURE.md, STRUCTURE.md, CONVENTIONS.md, TESTING.md, CONCERNS.md
- Generated by: `/gsd:map-codebase` command for AI-assisted development

## Key File Locations

**Entry Points:**
- `apps/api/src/main.rs` - Axum API server, service composition, router setup
- `apps/web/src/router.tsx` - React router initialization, provider wrapping
- `apps/desktop/src-tauri/src/lib.rs` - Tauri app setup, plugin initialization
- `apps/web/src/routes/__root.tsx` - Web app root layout, metadata, context

**Configuration:**
- `Cargo.toml` - Rust workspace members, dependency versions, profile settings
- `apps/web/package.json` - Node dependencies, build scripts, Vite config reference
- `Cargo.lock` - Locked Rust versions
- `.prettierrc` - Code formatting rules
- `.oxlintrc.json` - Rust linting rules
- `apps/desktop/src-tauri/tauri.conf.json` - Tauri app metadata, permissions, plugin config

**Core API Logic:**
- `apps/api/src/main.rs` - Router orchestration
- `apps/api/src/auth.rs` - Authentication middleware (JWT validation, entitlements)
- `apps/api/src/env.rs` - Environment configuration parsing
- `crates/api-subscription/` - Subscription/billing service
- `crates/api-calendar/` - Calendar integration
- `crates/api-support/` - Support ticket management
- `crates/llm-proxy/` - LLM provider abstraction
- `crates/transcribe-proxy/` - STT provider abstraction

**Testing:**
- `apps/web/playwright.config.ts` - Playwright E2E test configuration
- `apps/web/tests/` - E2E test files
- `apps/web/scripts/` - Test utilities
- Each crate may have internal `#[cfg(test)]` tests

**Utilities & Shared:**
- `crates/utils/` - Shared utility functions
- `apps/web/src/utils/` - Web-specific helpers (download, sitemap)
- `apps/web/src/lib/` - Web library utilities
- `apps/web/src/lib/team.ts` - Team-related utilities

## Naming Conventions

**Files:**
- TypeScript: `camelCase.ts` or `kebab-case.tsx` for React components
- Rust: `snake_case.rs`
- Components: `PascalCase.tsx` for React components (e.g., `Footer.tsx`, `Header.tsx`)
- Hooks: `useXxx.ts` for React hooks (e.g., `usePlatform.ts`, `useMediaApi.tsx`)
- Functions: `kebab-case.ts` for utility functions (e.g., `github-content.ts`, `supabase-media.ts`)

**Directories:**
- App level: `kebab-case` (e.g., `apps/api`, `apps/web`, `apps/desktop`)
- Crate level: `kebab-case` (e.g., `crates/api-auth`, `crates/llm-proxy`, `crates/audio-device`)
- Plugin level: `kebab-case` (e.g., `plugins/local-llm`, `plugins/db2`)
- Feature directories: `kebab-case` (e.g., `src/routes`, `src/components`, `src/middleware`)
- By type: `plural` (e.g., `components/`, `hooks/`, `functions/`, `routes/`, `utils/`)

**Packages:**
- Rust crates: `hypr-{name}` in workspace (e.g., `hypr-api-subscription`, `hypr-llm-proxy`)
- Node packages: `@hypr/{name}` scoped (e.g., `@hypr/web`, `@hypr/ui`, `@hypr/utils`)

## Where to Add New Code

**New API Endpoint:**
- Create domain service in `crates/api-[domain]/src/lib.rs` with `pub async fn router()` function
- Register in `apps/api/src/main.rs` via `.nest()` or `.merge()`
- Pattern:
  ```rust
  // In crates/api-[domain]/src/lib.rs
  pub async fn router(config: DomainConfig) -> Router {
      Router::new()
          .route("/path", get(handler))
  }

  // In apps/api/src/main.rs
  .nest("/domain", hypr_api_domain::router(config))
  ```

**New Web Route:**
- Create file in `apps/web/src/routes/` following TanStack Router file convention
- Examples:
  - `apps/web/src/routes/dashboard.tsx` → `/dashboard`
  - `apps/web/src/routes/settings/account.tsx` → `/settings/account`
  - `apps/web/src/routes/_admin/route.tsx` + `_admin/index.tsx` → admin layout route
- File auto-compiled to route tree in `routeTree.gen.ts`

**New Web Component:**
- Create in `apps/web/src/components/[feature]/ComponentName.tsx`
- Use PascalCase naming for React component files
- Import shared UI components from `@hypr/ui`
- Follow existing component patterns (use `cn()` for conditional classes, avoid prop spreading)

**New Desktop Plugin:**
- Create directory `plugins/[name]/` with structure:
  - `src-tauri/src/lib.rs` - Rust plugin implementation
  - `src-tauri/Cargo.toml` - Plugin dependencies
  - `dist/index.ts` - TypeScript command wrappers
  - `package.json` - Plugin metadata
- Register in `apps/desktop/src-tauri/src/lib.rs`:
  ```rust
  builder = builder.plugin(tauri_plugin_[name]::init())
  ```

**New Server Function (SSR):**
- Create in `apps/web/src/functions/[feature].ts`
- Use async function that runs on server or client depending on context
- TanStack Start automatically serializes arguments and results
- Pattern:
  ```typescript
  export async function getData(id: string) {
      // Runs on server during SSR, on client during hydration
      return await fetch(`/api/data/${id}`).then(r => r.json())
  }
  ```

**Shared Library Code:**
- Create new crate in `crates/[domain]/` if reused across apps
- Add to workspace in `Cargo.toml` members
- Export public items in `src/lib.rs`
- Pattern:
  ```toml
  # crates/[domain]/Cargo.toml
  [package]
  name = "[domain]"
  publish = true

  # Cargo.toml (root)
  hypr-[domain] = { path = "crates/[domain]", package = "[domain]" }
  ```

**Utilities/Helpers:**
- Global helpers: `crates/utils/` (or create if needed)
- Web-specific: `apps/web/src/utils/`
- Component-scoped: Co-locate in same directory as component

## Special Directories

**`apps/web/src/routes/`:**
- Purpose: TanStack Router file-based routing
- Generated: `routeTree.gen.ts` auto-compiled from file structure
- Committed: Yes, source files committed; `routeTree.gen.ts` generated during build
- Convention: File path → route path
  - `index.tsx` → index route
  - `kebab-case.tsx` → named route
  - `$param.tsx` → dynamic parameter
  - `_layout.tsx` → layout without path segment
  - `route.tsx` + `index.tsx` → layout with path

**`apps/web/src/content/`:**
- Purpose: MDX/markdown content for documentation and blogs
- Format: Markdown files with frontmatter
- Processing: `content-collections` generates TypeScript interface
- Generated: `src/routeTree.gen.ts` includes content routes

**`crates/`:**
- Purpose: Shared library packages
- Generated: `Cargo.lock` (dependency lock file)
- Committed: Yes, `Cargo.lock` committed for reproducible builds
- Visibility: Crates exposed via workspace `Cargo.toml`, used by apps with path references

**`plugins/`:**
- Purpose: Tauri plugin implementations
- Generated: Build artifacts in `dist/`, `target/`
- Committed: Source code committed; build artifacts in `.gitignore`
- Plugin Discovery: Auto-loaded from `plugins/[name]/` directories, registered in Tauri builder

**`.planning/codebase/`:**
- Purpose: Architecture and structure documentation for GSD commands
- Generated: Created by `/gsd:map-codebase`
- Committed: Yes, documentation tracked in git
- Consumed by: `/gsd:plan-phase` and `/gsd:execute-phase` commands

---

*Structure analysis: 2026-02-11*
